# Cryptocurrency Exchange Backend (Bun + Express + PostgreSQL)

ระบบ Backend สำหรับแพลตฟอร์มซื้อขายแลกเปลี่ยนเหรียญดิจิทัลภายในระบบ  
พัฒนาด้วย [**Bun**](https://bun.sh), Node.js (Express), Typescript และ PostgreSQL

## คุณสมบัติของระบบ

1. **ระบบเทรดเหรียญ (Trading)**

   - สามารถซื้อขายเหรียญระหว่างผู้ใช้ภายในระบบ
   - การซื้อขายสามารถทำได้เฉพาะเหรียญชนิดเดียวกันเท่านั้น
   - ระบบจับคู่การซื้อขายโดยอัตโนมัติจากรายการเสนอซื้อ/เสนอขาย (Offer)

2. **การโอนเหรียญ (Token Transfer)**

   - โอนเหรียญจากผู้ใช้หนึ่งไปยังผู้ใช้อื่นภายในระบบ
   - ตรวจสอบความถูกต้องของจำนวนเหรียญและชนิดของเหรียญก่อนทำรายการ

3. **การโอนเงิน (Fiat Transfer)**
   - โอนเงินจากผู้ใช้หนึ่งไปยังผู้ใช้อื่นในระบบ
   - รองรับหลายสกุลเงิน
   - หากผู้รับไม่มีสกุลเงินนั้น ระบบจะสร้างกระเป๋าเงินให้โดยอัตโนมัติ

---

## ขั้นตอนการทำงานของระบบ

### การเทรดเหรียญ

1. ผู้ใช้สร้างรายการ Offer เพื่อเสนอขายหรือเสนอซื้อเหรียญ โดยต้องระบุ:

   - ประเภทการเสนอ (ซื้อหรือขาย)
   - จำนวนเหรียญ
   - ราคาต่อหน่วย

2. ระบบจะทำงานดังนี้:
   - หากมีรายการเสนอจากผู้ใช้อื่นที่ตรงตามเงื่อนไข (เหรียญเดียวกัน และราคาที่เหมาะสม) ระบบจะ:
     - จับคู่กับรายการที่ให้ผลตอบแทนดีที่สุด (เช่น ราคาสูงสุดถ้าเป็นการขาย)
     - ทำการแลกเปลี่ยนเหรียญและเงิน
     - บันทึกธุรกรรมการเทรด
   - หากยังไม่มีรายการที่ตรงเงื่อนไข:
     - ระบบจะบันทึกรายการในสถานะ `open`
     - เมื่อมีการเสนอใหม่ที่ตรงเงื่อนไขในอนาคต ระบบจะดำเนินการแลกเปลี่ยนโดยอัตโนมัติ
     - เปลี่ยนสถานะรายการเป็น `completed`
     - อัปเดตยอดเงิน / เหรียญของทั้งสองฝ่าย และบันทึกธุรกรรมการโอนเหรียญ + เงิน

### การโอนเงิน

1. ผู้ใช้ระบุ:

   - ผู้รับ
   - จำนวนเงิน
   - สกุลเงิน

2. การทำงาน:
   - ตรวจสอบว่ายอดเงินของผู้โอนเพียงพอหรือไม่
   - ตรวจสอบว่าผู้รับมีบัญชีในสกุลเงินดังกล่าวหรือไม่:
     - ถ้าไม่: สร้างบัญชีใหม่ให้
     - ถ้ามี: เพิ่มยอดเงินในบัญชีนั้น
   - ทำการบันทึกธุรกรรมการโอน

### การโอนเหรียญ

1. ผู้ใช้ระบุ:

   - ผู้รับ
   - จำนวนเหรียญ
   - ชนิดของเหรียญ

2. การทำงาน:
   - ตรวจสอบว่าเหรียญมีอยู่ในระบบ
   - ตรวจสอบว่าผู้โอนมีเหรียญเพียงพอ
   - ตรวจสอบว่าผู้รับมีเหรียญชนิดนี้หรือไม่:
     - ถ้าไม่: สร้างให้
     - ถ้ามี: เพิ่มจำนวนเหรียญ
   - ทำการบันทึกธุรกรรมการโอนเหรียญ

---

## การนำไปใช้งาน

### 1. ติดตั้ง Dependencies

```bash
bun install
```

### 2. รันเซิร์ฟเวอร์

```bash
bun dev
```
